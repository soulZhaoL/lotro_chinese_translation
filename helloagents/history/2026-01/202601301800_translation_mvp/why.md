# 变更提案: LOTRO 文本汉化系统 MVP

## 需求背景
当前以 Excel 为主的协作方式难以支撑大规模文本汉化的多人协作、版本追溯与质量控制，需要建立可扩展的协作平台。

## 产品分析

### 目标用户与场景
- **用户群体:** 汉化人员、管理员、临时游客（仅查看/轻量操作）
- **使用场景:** 大批量文本分工认领、协作翻译、变更追踪、术语一致性校验
- **核心痛点:** 文本量大、协作冲突、术语不一致、格式错误难以追溯

### 价值主张与成功指标
- **价值主张:** 提供可扩展的任务认领与翻译流程，并对变更与术语一致性提供保障
- **成功指标:** 列表筛选与翻译流程可用、变更历史完整记录、词典高亮与数量提示可用

### 人文关怀
- 最小化权限暴露，游客可登录但限制敏感操作；避免误操作导致数据丢失

## 变更内容
1. 设计用户/权限、主文本、认领、锁定、变更历史、词典等核心数据结构
2. 设计列表、详情、翻译、变更历史、词典管理等页面布局与交互
3. 设计文本锁定、防并发编辑、变更次数追踪与术语提示机制

## 影响范围
- **模块:** 用户与权限、文本任务与翻译、词典管理、文本校验
- **文件:** 新增方案包与知识库文档（实现阶段将新增前后端代码）
- **API:** 认证、主文本、认领、锁定、变更历史、词典、校验
- **数据:** 新建用户与角色表、主文本表、认领表、锁定表、变更历史表、词典表

## 核心场景

### 需求: 用户管理
**模块:** 用户与权限
提供登录、角色分配、权限可配置的基础能力。

#### 场景: 账号登录
- 用户输入用户名与密码
- 系统完成加盐 MD5 校验并返回用户角色

### 需求: 主文本列表与筛选
**模块:** 文本任务与翻译
支持按 fid、part、人员、状态、原文关键字、译文关键字筛选并分页。

#### 场景: 组合筛选
- 用户输入 fid 或关键字
- 系统返回分页结果并展示认领人员与编辑次数

### 需求: 认领与锁定
**模块:** 文本任务与翻译
支持多人认领，但进入翻译页时需锁定避免并发编辑。

#### 场景: 进入翻译页锁定
- 用户进入翻译页
- 系统创建锁定记录，提示锁定成功/失败

### 需求: 翻译与变更历史
**模块:** 文本任务与翻译
记录每次翻译变更，支持左右对比查看。

#### 场景: 查看变更历史
- 用户打开 changelog 页面
- 系统展示变更前后内容及操作者、时间、原因

### 需求: 词典高亮与数量提示
**模块:** 词典管理
原文中 key 出现 n 次，译文中 value 出现次数需一致，否则提示。

#### 场景: 翻译时提示
- 系统高亮原文与译文词条
- 若数量不一致，展示提示

### 需求: 文本格式校验
**模块:** 文本校验
保存前校验文本格式，规则待补充。

#### 场景: 保存前校验
- 用户提交翻译
- 系统执行格式校验并返回错误列表

## 风险评估
- **风险:** MD5 安全性有限、超大文本检索性能压力、锁定异常导致阻塞
- **缓解:** 加盐+限速、建立检索索引与分页策略、锁定超时与可手动释放
